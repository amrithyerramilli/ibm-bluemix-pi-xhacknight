/**
 * Copyright 2014 IBM Corp. All Rights Reserved.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

'use strict';

var express = require('express'),
  app = express(),
  bluemix = require('./config/bluemix'),
  watson = require('watson-developer-cloud'),
  extend = require('util')._extend,
  fs = require('fs'),
  dummy_text = fs.readFileSync('mobydick.txt');


// Bootstrap application settings
require('./config/express')(app);

// if bluemix credentials exists, then override local
var credentials = extend({
    version: '',
    url: '',
    username: '',
    password: ''
}, bluemix.getServiceCreds('personality_insights')); // VCAP_SERVICES

// Create the service wrapper
var personalityInsights = new watson.personality_insights(credentials);

// render index page
app.get('/', function(req, res) {
  res.render('index', { content: dummy_text });
});

app.post('/', function(req, res) {
  //console.log(req.body);
  personalityInsights.profile(req.body, function(err, profile) {
    if (err) {
      if (err.message){
        err = { error: err.message };
      }
      return res.status(err.code || 500).json(err || 'Error processing the request');
    }
    else
      return res.json(profile);
  });
});

app.post('/map', function(req, res) {
  personalityInsights.profile(req.body, function(err, profile) {
    if (err) {
      if (err.message){
        err = { error: err.message };
      }
      return res.status(err.code || 500).json(err || 'Error processing the request');
    }
    else
      return res.json(profile);
  });
});

app.post('/match', function(req, res) {
  req.body.m1 = req.body.m1 || '{"id":"*UNKNOWN*","source":"*UNKNOWN*","word_count":2211,"word_count_message":"There were 2,211 words in the input. We need a minimum of 3,500, preferably 6,000 or more, to compute statistically significant estimates","processed_lang":"en","tree":{"id":"r","name":"root","children":[{"id":"personality","name":"Big 5 ","children":[{"id":"Openness_parent","name":"Openness","category":"personality","percentage":0.9507155582712544,"children":[{"id":"Openness","name":"Openness","category":"personality","percentage":0.9507155582712544,"sampling_error":0.05564544696,"children":[{"id":"Adventurousness","name":"Adventurousness","category":"personality","percentage":0.7475611949505441,"sampling_error":0.04796580476},{"id":"Artistic interests","name":"Artistic interests","category":"personality","percentage":0.17290875336991474,"sampling_error":0.09840645164},{"id":"Emotionality","name":"Emotionality","category":"personality","percentage":0.298727476191873,"sampling_error":0.045154573600000004},{"id":"Imagination","name":"Imagination","category":"personality","percentage":0.9433641885609083,"sampling_error":0.059816341120000005},{"id":"Intellect","name":"Intellect","category":"personality","percentage":0.9379534778663756,"sampling_error":0.05220371896},{"id":"Liberalism","name":"Authority-challenging","category":"personality","percentage":0.9451374662308387,"sampling_error":0.0787720356}]},{"id":"Conscientiousness","name":"Conscientiousness","category":"personality","percentage":0.5039300941504715,"sampling_error":0.07165785748,"children":[{"id":"Achievement striving","name":"Achievement striving","category":"personality","percentage":0.4579032284512129,"sampling_error":0.09326581296},{"id":"Cautiousness","name":"Cautiousness","category":"personality","percentage":0.8552491854811621,"sampling_error":0.08616629972},{"id":"Dutifulness","name":"Dutifulness","category":"personality","percentage":0.15752566577808502,"sampling_error":0.05680072784},{"id":"Orderliness","name":"Orderliness","category":"personality","percentage":0.2317771227796233,"sampling_error":0.06629331368000001},{"id":"Self-discipline","name":"Self-discipline","category":"personality","percentage":0.15172577367759338,"sampling_error":0.04382118812},{"id":"Self-efficacy","name":"Self-efficacy","category":"personality","percentage":0.8125057793639066,"sampling_error":0.08693714524}]},{"id":"Extraversion","name":"Extraversion","category":"personality","percentage":0.16743429560815692,"sampling_error":0.05262699212,"children":[{"id":"Activity level","name":"Activity level","category":"personality","percentage":0.026483849435133697,"sampling_error":0.07288465064},{"id":"Assertiveness","name":"Assertiveness","category":"personality","percentage":0.21283353538817956,"sampling_error":0.07796783516},{"id":"Cheerfulness","name":"Cheerfulness","category":"personality","percentage":0.07779802282474485,"sampling_error":0.09766533404},{"id":"Excitement-seeking","name":"Excitement-seeking","category":"personality","percentage":0.031019624496975623,"sampling_error":0.07739312844},{"id":"Friendliness","name":"Outgoing","category":"personality","percentage":0.052310388783907945,"sampling_error":0.07060719684},{"id":"Gregariousness","name":"Gregariousness","category":"personality","percentage":0.015836194526102645,"sampling_error":0.054460931159999997}]},{"id":"Agreeableness","name":"Agreeableness","category":"personality","percentage":0.1309176279233938,"sampling_error":0.09150791084,"children":[{"id":"Altruism","name":"Altruism","category":"personality","percentage":0.14314555980868052,"sampling_error":0.06630805812},{"id":"Cooperation","name":"Cooperation","category":"personality","percentage":0.6991082864898702,"sampling_error":0.07542910259999999},{"id":"Modesty","name":"Modesty","category":"personality","percentage":0.029949489854718302,"sampling_error":0.051854124960000005},{"id":"Morality","name":"Uncompromising","category":"personality","percentage":0.12950094675644314,"sampling_error":0.059150285639999994},{"id":"Sympathy","name":"Sympathy","category":"personality","percentage":0.988032387028434,"sampling_error":0.0916498164},{"id":"Trust","name":"Trust","category":"personality","percentage":0.13939256931890254,"sampling_error":0.05171918492}]},{"id":"Neuroticism","name":"Emotional range","category":"personality","percentage":0.4191047135177268,"sampling_error":0.0841044178,"children":[{"id":"Anger","name":"Fiery","category":"personality","percentage":0.43158209688631544,"sampling_error":0.08834904016},{"id":"Anxiety","name":"Prone to worry","category":"personality","percentage":0.1644855429052556,"sampling_error":0.05141376412},{"id":"Depression","name":"Melancholy","category":"personality","percentage":0.3316707274189353,"sampling_error":0.054265146119999996},{"id":"Immoderation","name":"Immoderation","category":"personality","percentage":0.20248493442586335,"sampling_error":0.04974423864},{"id":"Self-consciousness","name":"Self-consciousness","category":"personality","percentage":0.3707520358860429,"sampling_error":0.05267397636},{"id":"Vulnerability","name":"Susceptible to stress","category":"personality","percentage":0.2502119048511144,"sampling_error":0.08031894076}]}]}]},{"id":"needs","name":"Needs","children":[{"id":"Ideal_parent","name":"Ideal","category":"needs","percentage":0.022413033084928397,"children":[{"id":"Challenge","name":"Challenge","category":"needs","percentage":0.04207240032883603,"sampling_error":0.078681255},{"id":"Closeness","name":"Closeness","category":"needs","percentage":0.055490186602770206,"sampling_error":0.07778854512},{"id":"Curiosity","name":"Curiosity","category":"needs","percentage":0.06721761198872232,"sampling_error":0.11149643532},{"id":"Excitement","name":"Excitement","category":"needs","percentage":0.03864801075160132,"sampling_error":0.10186707596},{"id":"Harmony","name":"Harmony","category":"needs","percentage":0.4481117756345261,"sampling_error":0.1012082272},{"id":"Ideal","name":"Ideal","category":"needs","percentage":0.022413033084928397,"sampling_error":0.09183725316},{"id":"Liberty","name":"Liberty","category":"needs","percentage":0.10842188146505852,"sampling_error":0.13629254863999998},{"id":"Love","name":"Love","category":"needs","percentage":0.2613144360292408,"sampling_error":0.09310442776},{"id":"Practicality","name":"Practicality","category":"needs","percentage":0.33819191265217813,"sampling_error":0.08133299836},{"id":"Self-expression","name":"Self-expression","category":"needs","percentage":0.04897972423549285,"sampling_error":0.07606954044},{"id":"Stability","name":"Stability","category":"needs","percentage":0.045710980083320946,"sampling_error":0.09902254167999999},{"id":"Structure","name":"Structure","category":"needs","percentage":0.041799741826534086,"sampling_error":0.07454023536}]}]},{"id":"values","name":"Values","children":[{"id":"Conservation_parent","name":"Conservation","category":"values","percentage":0.029023918019099572,"children":[{"id":"Conservation","name":"Conservation","category":"values","percentage":0.029023918019099572,"sampling_error":0.06478851732},{"id":"Openness to change","name":"Openness to change","category":"values","percentage":0.9588786386017498,"sampling_error":0.06049861548},{"id":"Hedonism","name":"Hedonism","category":"values","percentage":0.32357488572180204,"sampling_error":0.12806277544},{"id":"Self-enhancement","name":"Self-enhancement","category":"values","percentage":0.46766796894424184,"sampling_error":0.09597471576},{"id":"Self-transcendence","name":"Self-transcendence","category":"values","percentage":0.7694947212735894,"sampling_error":0.0735369558}]}]}]}}';
  req.body.m2 = req.body.m2 || '{"id":"*UNKNOWN*","source":"*UNKNOWN*","word_count":2211,"word_count_message":"There were 2,211 words in the input. We need a minimum of 3,500, preferably 6,000 or more, to compute statistically significant estimates","processed_lang":"en","tree":{"id":"r","name":"root","children":[{"id":"personality","name":"Big 5 ","children":[{"id":"Openness_parent","name":"Openness","category":"personality","percentage":0.9507155582712544,"children":[{"id":"Openness","name":"Openness","category":"personality","percentage":0.9107155582712544,"sampling_error":0.05564544696,"children":[{"id":"Adventurousness","name":"Adventurousness","category":"personality","percentage":0.7475611949505441,"sampling_error":0.04796580476},{"id":"Artistic interests","name":"Artistic interests","category":"personality","percentage":0.17290875336991474,"sampling_error":0.09840645164},{"id":"Emotionality","name":"Emotionality","category":"personality","percentage":0.298727476191873,"sampling_error":0.045154573600000004},{"id":"Imagination","name":"Imagination","category":"personality","percentage":0.9433641885609083,"sampling_error":0.059816341120000005},{"id":"Intellect","name":"Intellect","category":"personality","percentage":0.9379534778663756,"sampling_error":0.05220371896},{"id":"Liberalism","name":"Authority-challenging","category":"personality","percentage":0.9451374662308387,"sampling_error":0.0787720356}]},{"id":"Conscientiousness","name":"Conscientiousness","category":"personality","percentage":0.8039300941504715,"sampling_error":0.07165785748,"children":[{"id":"Achievement striving","name":"Achievement striving","category":"personality","percentage":0.4579032284512129,"sampling_error":0.09326581296},{"id":"Cautiousness","name":"Cautiousness","category":"personality","percentage":0.8552491854811621,"sampling_error":0.08616629972},{"id":"Dutifulness","name":"Dutifulness","category":"personality","percentage":0.15752566577808502,"sampling_error":0.05680072784},{"id":"Orderliness","name":"Orderliness","category":"personality","percentage":0.2317771227796233,"sampling_error":0.06629331368000001},{"id":"Self-discipline","name":"Self-discipline","category":"personality","percentage":0.15172577367759338,"sampling_error":0.04382118812},{"id":"Self-efficacy","name":"Self-efficacy","category":"personality","percentage":0.8125057793639066,"sampling_error":0.08693714524}]},{"id":"Extraversion","name":"Extraversion","category":"personality","percentage":0.36743429560815692,"sampling_error":0.05262699212,"children":[{"id":"Activity level","name":"Activity level","category":"personality","percentage":0.026483849435133697,"sampling_error":0.07288465064},{"id":"Assertiveness","name":"Assertiveness","category":"personality","percentage":0.21283353538817956,"sampling_error":0.07796783516},{"id":"Cheerfulness","name":"Cheerfulness","category":"personality","percentage":0.07779802282474485,"sampling_error":0.09766533404},{"id":"Excitement-seeking","name":"Excitement-seeking","category":"personality","percentage":0.031019624496975623,"sampling_error":0.07739312844},{"id":"Friendliness","name":"Outgoing","category":"personality","percentage":0.052310388783907945,"sampling_error":0.07060719684},{"id":"Gregariousness","name":"Gregariousness","category":"personality","percentage":0.015836194526102645,"sampling_error":0.054460931159999997}]},{"id":"Agreeableness","name":"Agreeableness","category":"personality","percentage":0.4409176279233938,"sampling_error":0.09150791084,"children":[{"id":"Altruism","name":"Altruism","category":"personality","percentage":0.14314555980868052,"sampling_error":0.06630805812},{"id":"Cooperation","name":"Cooperation","category":"personality","percentage":0.6991082864898702,"sampling_error":0.07542910259999999},{"id":"Modesty","name":"Modesty","category":"personality","percentage":0.029949489854718302,"sampling_error":0.051854124960000005},{"id":"Morality","name":"Uncompromising","category":"personality","percentage":0.12950094675644314,"sampling_error":0.059150285639999994},{"id":"Sympathy","name":"Sympathy","category":"personality","percentage":0.988032387028434,"sampling_error":0.0916498164},{"id":"Trust","name":"Trust","category":"personality","percentage":0.13939256931890254,"sampling_error":0.05171918492}]},{"id":"Neuroticism","name":"Emotional range","category":"personality","percentage":0.4191047135177268,"sampling_error":0.0841044178,"children":[{"id":"Anger","name":"Fiery","category":"personality","percentage":0.43158209688631544,"sampling_error":0.08834904016},{"id":"Anxiety","name":"Prone to worry","category":"personality","percentage":0.1644855429052556,"sampling_error":0.05141376412},{"id":"Depression","name":"Melancholy","category":"personality","percentage":0.3316707274189353,"sampling_error":0.054265146119999996},{"id":"Immoderation","name":"Immoderation","category":"personality","percentage":0.20248493442586335,"sampling_error":0.04974423864},{"id":"Self-consciousness","name":"Self-consciousness","category":"personality","percentage":0.3707520358860429,"sampling_error":0.05267397636},{"id":"Vulnerability","name":"Susceptible to stress","category":"personality","percentage":0.2502119048511144,"sampling_error":0.08031894076}]}]}]},{"id":"needs","name":"Needs","children":[{"id":"Ideal_parent","name":"Ideal","category":"needs","percentage":0.022413033084928397,"children":[{"id":"Challenge","name":"Challenge","category":"needs","percentage":0.04207240032883603,"sampling_error":0.078681255},{"id":"Closeness","name":"Closeness","category":"needs","percentage":0.055490186602770206,"sampling_error":0.07778854512},{"id":"Curiosity","name":"Curiosity","category":"needs","percentage":0.06721761198872232,"sampling_error":0.11149643532},{"id":"Excitement","name":"Excitement","category":"needs","percentage":0.03864801075160132,"sampling_error":0.10186707596},{"id":"Harmony","name":"Harmony","category":"needs","percentage":0.4481117756345261,"sampling_error":0.1012082272},{"id":"Ideal","name":"Ideal","category":"needs","percentage":0.022413033084928397,"sampling_error":0.09183725316},{"id":"Liberty","name":"Liberty","category":"needs","percentage":0.10842188146505852,"sampling_error":0.13629254863999998},{"id":"Love","name":"Love","category":"needs","percentage":0.2613144360292408,"sampling_error":0.09310442776},{"id":"Practicality","name":"Practicality","category":"needs","percentage":0.33819191265217813,"sampling_error":0.08133299836},{"id":"Self-expression","name":"Self-expression","category":"needs","percentage":0.04897972423549285,"sampling_error":0.07606954044},{"id":"Stability","name":"Stability","category":"needs","percentage":0.045710980083320946,"sampling_error":0.09902254167999999},{"id":"Structure","name":"Structure","category":"needs","percentage":0.041799741826534086,"sampling_error":0.07454023536}]}]},{"id":"values","name":"Values","children":[{"id":"Conservation_parent","name":"Conservation","category":"values","percentage":0.159023918019099572,"children":[{"id":"Conservation","name":"Conservation","category":"values","percentage":0.029023918019099572,"sampling_error":0.06478851732},{"id":"Openness to change","name":"Openness to change","category":"values","percentage":0.2588786386017498,"sampling_error":0.06049861548},{"id":"Hedonism","name":"Hedonism","category":"values","percentage":0.32357488572180204,"sampling_error":0.12806277544},{"id":"Self-enhancement","name":"Self-enhancement","category":"values","percentage":0.46766796894424184,"sampling_error":0.09597471576},{"id":"Self-transcendence","name":"Self-transcendence","category":"values","percentage":0.2694947212735894,"sampling_error":0.0735369558}]}]}]}}';

  var m1 = JSON.parse(req.body.m1);
  var m2 = JSON.parse(req.body.m2);
  
  var response = {};

  var overall_match_diff_avg = 0;
  var needs_match_diff_avg = 0;
  var values_match_diff_avg = 0;

  var m1_vals = [];
  var m2_vals = [];
  var match_vals = [];

  // overall
  console.log("--overall--")
  for(var i=0; i<m1['tree']['children'][0]['children'].length; i++) {
    for(var j=0; j<m1['tree']['children'][0]['children'][i]['children'].length; j++) {
      //console.log(b['p1']['tree']['children'][0]['children'][i]['children'][j]['name']+ ',' +b['p1']['tree']['children'][0]['children'][i]['children'][j]['percentage']);
      m1_vals.push(parseInt(m1['tree']['children'][0]['children'][i]['children'][j]['percentage']*100));
      m2_vals.push(parseInt(m2['tree']['children'][0]['children'][i]['children'][j]['percentage']*100));
      match_vals.push((m1_vals[m1_vals.length-1] - m2_vals[m1_vals.length-1]) < 0 ? (m1_vals[m1_vals.length-1] - m2_vals[m1_vals.length-1])*-1 : (m1_vals[m1_vals.length-1] - m2_vals[m1_vals.length-1]));
      
      console.log(m1_vals[m1_vals.length-1] +","+ m2_vals[m2_vals.length-1]);
    }
  }

  for (var i=0; i<match_vals.length; i++) {
    overall_match_diff_avg += match_vals[i];
  }
  overall_match_diff_avg = 100-parseInt(overall_match_diff_avg/match_vals.length);
  response['overall'] = overall_match_diff_avg;

  // needs
  console.log("--needs--")
  var m1_vals = [];
  var m2_vals = [];
  var match_vals = [];

  for(var i=0; i<m1['tree']['children'][1]['children'].length; i++) {
    for(var j=0; j<m1['tree']['children'][1]['children'][i]['children'].length; j++) {
      //console.log(b['p1']['tree']['children'][0]['children'][i]['children'][j]['name']+ ',' +b['p1']['tree']['children'][0]['children'][i]['children'][j]['percentage']);
      m1_vals.push(parseInt(m1['tree']['children'][1]['children'][i]['children'][j]['percentage']*100));
      m2_vals.push(parseInt(m2['tree']['children'][1]['children'][i]['children'][j]['percentage']*100));
      match_vals.push((m1_vals[m1_vals.length-1] - m2_vals[m1_vals.length-1]) < 0 ? (m1_vals[m1_vals.length-1] - m2_vals[m1_vals.length-1])*-1 : (m1_vals[m1_vals.length-1] - m2_vals[m1_vals.length-1]));

      console.log(m1_vals[m1_vals.length-1] +","+ m2_vals[m2_vals.length-1]);
    }
  }
  for (var i=0; i<match_vals.length; i++) {
    console.log(match_vals[i]);
    needs_match_diff_avg += match_vals[i];
  }
  needs_match_diff_avg = 100-parseInt(needs_match_diff_avg/match_vals.length);
  response['needs'] = needs_match_diff_avg;

  // values
  console.log("--values--")
  var m1_vals = [];
  var m2_vals = [];
  var match_vals = [];

  for(var i=0; i<m1['tree']['children'][2]['children'].length; i++) {
    for(var j=0; j<m1['tree']['children'][2]['children'][i]['children'].length; j++) {
      //console.log(b['p1']['tree']['children'][0]['children'][i]['children'][j]['name']+ ',' +b['p1']['tree']['children'][0]['children'][i]['children'][j]['percentage']);
      m1_vals.push(parseInt(m1['tree']['children'][2]['children'][i]['children'][j]['percentage']*100));
      m2_vals.push(parseInt(m2['tree']['children'][2]['children'][i]['children'][j]['percentage']*100));
      match_vals.push((m1_vals[m1_vals.length-1] - m2_vals[m1_vals.length-1]) < 0 ? (m1_vals[m1_vals.length-1] - m2_vals[m1_vals.length-1])*-1 : (m1_vals[m1_vals.length-1] - m2_vals[m1_vals.length-1]));
      
      console.log(m1_vals[m1_vals.length-1] +","+ m2_vals[m2_vals.length-1]);
    }
  }
  for (var i=0; i<match_vals.length; i++) {
    values_match_diff_avg += match_vals[i];
  }
  values_match_diff_avg = 100-parseInt(values_match_diff_avg/match_vals.length);
  response['values'] = values_match_diff_avg;

  return res.json(response);
});

app.post('/bulk_match', function(req, res) {
  personalityInsights.profile(req.body, function(err, profile) {
    if (err) {
      if (err.message){
        err = { error: err.message };
      }
      return res.status(err.code || 500).json(err || 'Error processing the request');
    }
    else
      // here is the user's live `profile` analysis
      var mock_profiles = ['{"id":"*UNKNOWN*","source":"*UNKNOWN*","word_count":2211,"word_count_message":"There were 2,211 words in the input. We need a minimum of 3,500, preferably 6,000 or more, to compute statistically significant estimates","processed_lang":"en","tree":{"id":"r","name":"root","children":[{"id":"personality","name":"Big 5 ","children":[{"id":"Openness_parent","name":"Openness","category":"personality","percentage":0.9507155582712544,"children":[{"id":"Openness","name":"Openness","category":"personality","percentage":0.9507155582712544,"sampling_error":0.05564544696,"children":[{"id":"Adventurousness","name":"Adventurousness","category":"personality","percentage":0.7475611949505441,"sampling_error":0.04796580476},{"id":"Artistic interests","name":"Artistic interests","category":"personality","percentage":0.17290875336991474,"sampling_error":0.09840645164},{"id":"Emotionality","name":"Emotionality","category":"personality","percentage":0.298727476191873,"sampling_error":0.045154573600000004},{"id":"Imagination","name":"Imagination","category":"personality","percentage":0.9433641885609083,"sampling_error":0.059816341120000005},{"id":"Intellect","name":"Intellect","category":"personality","percentage":0.9379534778663756,"sampling_error":0.05220371896},{"id":"Liberalism","name":"Authority-challenging","category":"personality","percentage":0.9451374662308387,"sampling_error":0.0787720356}]},{"id":"Conscientiousness","name":"Conscientiousness","category":"personality","percentage":0.5039300941504715,"sampling_error":0.07165785748,"children":[{"id":"Achievement striving","name":"Achievement striving","category":"personality","percentage":0.4579032284512129,"sampling_error":0.09326581296},{"id":"Cautiousness","name":"Cautiousness","category":"personality","percentage":0.8552491854811621,"sampling_error":0.08616629972},{"id":"Dutifulness","name":"Dutifulness","category":"personality","percentage":0.15752566577808502,"sampling_error":0.05680072784},{"id":"Orderliness","name":"Orderliness","category":"personality","percentage":0.2317771227796233,"sampling_error":0.06629331368000001},{"id":"Self-discipline","name":"Self-discipline","category":"personality","percentage":0.15172577367759338,"sampling_error":0.04382118812},{"id":"Self-efficacy","name":"Self-efficacy","category":"personality","percentage":0.8125057793639066,"sampling_error":0.08693714524}]},{"id":"Extraversion","name":"Extraversion","category":"personality","percentage":0.16743429560815692,"sampling_error":0.05262699212,"children":[{"id":"Activity level","name":"Activity level","category":"personality","percentage":0.026483849435133697,"sampling_error":0.07288465064},{"id":"Assertiveness","name":"Assertiveness","category":"personality","percentage":0.21283353538817956,"sampling_error":0.07796783516},{"id":"Cheerfulness","name":"Cheerfulness","category":"personality","percentage":0.07779802282474485,"sampling_error":0.09766533404},{"id":"Excitement-seeking","name":"Excitement-seeking","category":"personality","percentage":0.031019624496975623,"sampling_error":0.07739312844},{"id":"Friendliness","name":"Outgoing","category":"personality","percentage":0.052310388783907945,"sampling_error":0.07060719684},{"id":"Gregariousness","name":"Gregariousness","category":"personality","percentage":0.015836194526102645,"sampling_error":0.054460931159999997}]},{"id":"Agreeableness","name":"Agreeableness","category":"personality","percentage":0.1309176279233938,"sampling_error":0.09150791084,"children":[{"id":"Altruism","name":"Altruism","category":"personality","percentage":0.14314555980868052,"sampling_error":0.06630805812},{"id":"Cooperation","name":"Cooperation","category":"personality","percentage":0.6991082864898702,"sampling_error":0.07542910259999999},{"id":"Modesty","name":"Modesty","category":"personality","percentage":0.029949489854718302,"sampling_error":0.051854124960000005},{"id":"Morality","name":"Uncompromising","category":"personality","percentage":0.12950094675644314,"sampling_error":0.059150285639999994},{"id":"Sympathy","name":"Sympathy","category":"personality","percentage":0.988032387028434,"sampling_error":0.0916498164},{"id":"Trust","name":"Trust","category":"personality","percentage":0.13939256931890254,"sampling_error":0.05171918492}]},{"id":"Neuroticism","name":"Emotional range","category":"personality","percentage":0.4191047135177268,"sampling_error":0.0841044178,"children":[{"id":"Anger","name":"Fiery","category":"personality","percentage":0.43158209688631544,"sampling_error":0.08834904016},{"id":"Anxiety","name":"Prone to worry","category":"personality","percentage":0.1644855429052556,"sampling_error":0.05141376412},{"id":"Depression","name":"Melancholy","category":"personality","percentage":0.3316707274189353,"sampling_error":0.054265146119999996},{"id":"Immoderation","name":"Immoderation","category":"personality","percentage":0.20248493442586335,"sampling_error":0.04974423864},{"id":"Self-consciousness","name":"Self-consciousness","category":"personality","percentage":0.3707520358860429,"sampling_error":0.05267397636},{"id":"Vulnerability","name":"Susceptible to stress","category":"personality","percentage":0.2502119048511144,"sampling_error":0.08031894076}]}]}]},{"id":"needs","name":"Needs","children":[{"id":"Ideal_parent","name":"Ideal","category":"needs","percentage":0.022413033084928397,"children":[{"id":"Challenge","name":"Challenge","category":"needs","percentage":0.04207240032883603,"sampling_error":0.078681255},{"id":"Closeness","name":"Closeness","category":"needs","percentage":0.055490186602770206,"sampling_error":0.07778854512},{"id":"Curiosity","name":"Curiosity","category":"needs","percentage":0.06721761198872232,"sampling_error":0.11149643532},{"id":"Excitement","name":"Excitement","category":"needs","percentage":0.03864801075160132,"sampling_error":0.10186707596},{"id":"Harmony","name":"Harmony","category":"needs","percentage":0.4481117756345261,"sampling_error":0.1012082272},{"id":"Ideal","name":"Ideal","category":"needs","percentage":0.022413033084928397,"sampling_error":0.09183725316},{"id":"Liberty","name":"Liberty","category":"needs","percentage":0.10842188146505852,"sampling_error":0.13629254863999998},{"id":"Love","name":"Love","category":"needs","percentage":0.2613144360292408,"sampling_error":0.09310442776},{"id":"Practicality","name":"Practicality","category":"needs","percentage":0.33819191265217813,"sampling_error":0.08133299836},{"id":"Self-expression","name":"Self-expression","category":"needs","percentage":0.04897972423549285,"sampling_error":0.07606954044},{"id":"Stability","name":"Stability","category":"needs","percentage":0.045710980083320946,"sampling_error":0.09902254167999999},{"id":"Structure","name":"Structure","category":"needs","percentage":0.041799741826534086,"sampling_error":0.07454023536}]}]},{"id":"values","name":"Values","children":[{"id":"Conservation_parent","name":"Conservation","category":"values","percentage":0.029023918019099572,"children":[{"id":"Conservation","name":"Conservation","category":"values","percentage":0.029023918019099572,"sampling_error":0.06478851732},{"id":"Openness to change","name":"Openness to change","category":"values","percentage":0.9588786386017498,"sampling_error":0.06049861548},{"id":"Hedonism","name":"Hedonism","category":"values","percentage":0.32357488572180204,"sampling_error":0.12806277544},{"id":"Self-enhancement","name":"Self-enhancement","category":"values","percentage":0.46766796894424184,"sampling_error":0.09597471576},{"id":"Self-transcendence","name":"Self-transcendence","category":"values","percentage":0.7694947212735894,"sampling_error":0.0735369558}]}]}]}}', '{"id":"*UNKNOWN*","source":"*UNKNOWN*","word_count":2211,"word_count_message":"There were 2,211 words in the input. We need a minimum of 3,500, preferably 6,000 or more, to compute statistically significant estimates","processed_lang":"en","tree":{"id":"r","name":"root","children":[{"id":"personality","name":"Big 5 ","children":[{"id":"Openness_parent","name":"Openness","category":"personality","percentage":0.9507155582712544,"children":[{"id":"Openness","name":"Openness","category":"personality","percentage":0.9107155582712544,"sampling_error":0.05564544696,"children":[{"id":"Adventurousness","name":"Adventurousness","category":"personality","percentage":0.7475611949505441,"sampling_error":0.04796580476},{"id":"Artistic interests","name":"Artistic interests","category":"personality","percentage":0.17290875336991474,"sampling_error":0.09840645164},{"id":"Emotionality","name":"Emotionality","category":"personality","percentage":0.298727476191873,"sampling_error":0.045154573600000004},{"id":"Imagination","name":"Imagination","category":"personality","percentage":0.9433641885609083,"sampling_error":0.059816341120000005},{"id":"Intellect","name":"Intellect","category":"personality","percentage":0.9379534778663756,"sampling_error":0.05220371896},{"id":"Liberalism","name":"Authority-challenging","category":"personality","percentage":0.9451374662308387,"sampling_error":0.0787720356}]},{"id":"Conscientiousness","name":"Conscientiousness","category":"personality","percentage":0.8039300941504715,"sampling_error":0.07165785748,"children":[{"id":"Achievement striving","name":"Achievement striving","category":"personality","percentage":0.4579032284512129,"sampling_error":0.09326581296},{"id":"Cautiousness","name":"Cautiousness","category":"personality","percentage":0.8552491854811621,"sampling_error":0.08616629972},{"id":"Dutifulness","name":"Dutifulness","category":"personality","percentage":0.15752566577808502,"sampling_error":0.05680072784},{"id":"Orderliness","name":"Orderliness","category":"personality","percentage":0.2317771227796233,"sampling_error":0.06629331368000001},{"id":"Self-discipline","name":"Self-discipline","category":"personality","percentage":0.15172577367759338,"sampling_error":0.04382118812},{"id":"Self-efficacy","name":"Self-efficacy","category":"personality","percentage":0.8125057793639066,"sampling_error":0.08693714524}]},{"id":"Extraversion","name":"Extraversion","category":"personality","percentage":0.36743429560815692,"sampling_error":0.05262699212,"children":[{"id":"Activity level","name":"Activity level","category":"personality","percentage":0.026483849435133697,"sampling_error":0.07288465064},{"id":"Assertiveness","name":"Assertiveness","category":"personality","percentage":0.21283353538817956,"sampling_error":0.07796783516},{"id":"Cheerfulness","name":"Cheerfulness","category":"personality","percentage":0.07779802282474485,"sampling_error":0.09766533404},{"id":"Excitement-seeking","name":"Excitement-seeking","category":"personality","percentage":0.031019624496975623,"sampling_error":0.07739312844},{"id":"Friendliness","name":"Outgoing","category":"personality","percentage":0.052310388783907945,"sampling_error":0.07060719684},{"id":"Gregariousness","name":"Gregariousness","category":"personality","percentage":0.015836194526102645,"sampling_error":0.054460931159999997}]},{"id":"Agreeableness","name":"Agreeableness","category":"personality","percentage":0.4409176279233938,"sampling_error":0.09150791084,"children":[{"id":"Altruism","name":"Altruism","category":"personality","percentage":0.14314555980868052,"sampling_error":0.06630805812},{"id":"Cooperation","name":"Cooperation","category":"personality","percentage":0.6991082864898702,"sampling_error":0.07542910259999999},{"id":"Modesty","name":"Modesty","category":"personality","percentage":0.029949489854718302,"sampling_error":0.051854124960000005},{"id":"Morality","name":"Uncompromising","category":"personality","percentage":0.12950094675644314,"sampling_error":0.059150285639999994},{"id":"Sympathy","name":"Sympathy","category":"personality","percentage":0.988032387028434,"sampling_error":0.0916498164},{"id":"Trust","name":"Trust","category":"personality","percentage":0.13939256931890254,"sampling_error":0.05171918492}]},{"id":"Neuroticism","name":"Emotional range","category":"personality","percentage":0.4191047135177268,"sampling_error":0.0841044178,"children":[{"id":"Anger","name":"Fiery","category":"personality","percentage":0.43158209688631544,"sampling_error":0.08834904016},{"id":"Anxiety","name":"Prone to worry","category":"personality","percentage":0.1644855429052556,"sampling_error":0.05141376412},{"id":"Depression","name":"Melancholy","category":"personality","percentage":0.3316707274189353,"sampling_error":0.054265146119999996},{"id":"Immoderation","name":"Immoderation","category":"personality","percentage":0.20248493442586335,"sampling_error":0.04974423864},{"id":"Self-consciousness","name":"Self-consciousness","category":"personality","percentage":0.3707520358860429,"sampling_error":0.05267397636},{"id":"Vulnerability","name":"Susceptible to stress","category":"personality","percentage":0.2502119048511144,"sampling_error":0.08031894076}]}]}]},{"id":"needs","name":"Needs","children":[{"id":"Ideal_parent","name":"Ideal","category":"needs","percentage":0.022413033084928397,"children":[{"id":"Challenge","name":"Challenge","category":"needs","percentage":0.04207240032883603,"sampling_error":0.078681255},{"id":"Closeness","name":"Closeness","category":"needs","percentage":0.055490186602770206,"sampling_error":0.07778854512},{"id":"Curiosity","name":"Curiosity","category":"needs","percentage":0.06721761198872232,"sampling_error":0.11149643532},{"id":"Excitement","name":"Excitement","category":"needs","percentage":0.03864801075160132,"sampling_error":0.10186707596},{"id":"Harmony","name":"Harmony","category":"needs","percentage":0.4481117756345261,"sampling_error":0.1012082272},{"id":"Ideal","name":"Ideal","category":"needs","percentage":0.022413033084928397,"sampling_error":0.09183725316},{"id":"Liberty","name":"Liberty","category":"needs","percentage":0.10842188146505852,"sampling_error":0.13629254863999998},{"id":"Love","name":"Love","category":"needs","percentage":0.2613144360292408,"sampling_error":0.09310442776},{"id":"Practicality","name":"Practicality","category":"needs","percentage":0.33819191265217813,"sampling_error":0.08133299836},{"id":"Self-expression","name":"Self-expression","category":"needs","percentage":0.04897972423549285,"sampling_error":0.07606954044},{"id":"Stability","name":"Stability","category":"needs","percentage":0.045710980083320946,"sampling_error":0.09902254167999999},{"id":"Structure","name":"Structure","category":"needs","percentage":0.041799741826534086,"sampling_error":0.07454023536}]}]},{"id":"values","name":"Values","children":[{"id":"Conservation_parent","name":"Conservation","category":"values","percentage":0.159023918019099572,"children":[{"id":"Conservation","name":"Conservation","category":"values","percentage":0.029023918019099572,"sampling_error":0.06478851732},{"id":"Openness to change","name":"Openness to change","category":"values","percentage":0.2588786386017498,"sampling_error":0.06049861548},{"id":"Hedonism","name":"Hedonism","category":"values","percentage":0.32357488572180204,"sampling_error":0.12806277544},{"id":"Self-enhancement","name":"Self-enhancement","category":"values","percentage":0.46766796894424184,"sampling_error":0.09597471576},{"id":"Self-transcendence","name":"Self-transcendence","category":"values","percentage":0.2694947212735894,"sampling_error":0.0735369558}]}]}]}}','{"id":"*UNKNOWN*","source":"*UNKNOWN*","word_count":1015,"word_count_message":"There were 1,015 words in the input. We need a minimum of 3,500, preferably 6,000 or more, to compute statistically significant estimates","processed_lang":"en","tree":{"id":"r","name":"root","children":[{"id":"personality","name":"Big 5 ","children":[{"id":"Openness_parent","name":"Openness","category":"personality","percentage":1,"children":[{"id":"Openness","name":"Openness","category":"personality","percentage":1,"sampling_error":0.0588568,"children":[{"id":"Adventurousness","name":"Adventurousness","category":"personality","percentage":0.9116760375868227,"sampling_error":0.050200718},{"id":"Artistic interests","name":"Artistic interests","category":"personality","percentage":0.08934504643912047,"sampling_error":0.10255887400000001},{"id":"Emotionality","name":"Emotionality","category":"personality","percentage":0.14644988840079623,"sampling_error":0.047062840499999994},{"id":"Imagination","name":"Imagination","category":"personality","percentage":1,"sampling_error":0.06301538250000001},{"id":"Intellect","name":"Intellect","category":"personality","percentage":1,"sampling_error":0.0549705815},{"id":"Liberalism","name":"Authority-challenging","category":"personality","percentage":0.9601307782330681,"sampling_error":0.082397159}]},{"id":"Conscientiousness","name":"Conscientiousness","category":"personality","percentage":0.4969585873203399,"sampling_error":0.0747940505,"children":[{"id":"Achievement striving","name":"Achievement striving","category":"personality","percentage":0.31863781239683675,"sampling_error":0.097098615},{"id":"Cautiousness","name":"Cautiousness","category":"personality","percentage":0.9065328645054396,"sampling_error":0.09048567049999999},{"id":"Dutifulness","name":"Dutifulness","category":"personality","percentage":0.07447994515570278,"sampling_error":0.059376658},{"id":"Orderliness","name":"Orderliness","category":"personality","percentage":0.009654997715125313,"sampling_error":0.0690735905},{"id":"Self-discipline","name":"Self-discipline","category":"personality","percentage":0.052194679180267246,"sampling_error":0.0464876245},{"id":"Self-efficacy","name":"Self-efficacy","category":"personality","percentage":0.8845614571046004,"sampling_error":0.090874456}]},{"id":"Extraversion","name":"Extraversion","category":"personality","percentage":0.2190118993066767,"sampling_error":0.0554921025,"children":[{"id":"Activity level","name":"Activity level","category":"personality","percentage":0.018190735093513107,"sampling_error":0.0764362165},{"id":"Assertiveness","name":"Assertiveness","category":"personality","percentage":0.1732790279635383,"sampling_error":0.081893139},{"id":"Cheerfulness","name":"Cheerfulness","category":"personality","percentage":0.039280636819997064,"sampling_error":0.10286286750000001},{"id":"Excitement-seeking","name":"Excitement-seeking","category":"personality","percentage":0.032001871161435436,"sampling_error":0.0804161745},{"id":"Friendliness","name":"Outgoing","category":"personality","percentage":0.053351572592237814,"sampling_error":0.07403971200000001},{"id":"Gregariousness","name":"Gregariousness","category":"personality","percentage":0.014422166557590115,"sampling_error":0.057257363500000005}]},{"id":"Agreeableness","name":"Agreeableness","category":"personality","percentage":0.041659419690668775,"sampling_error":0.09525654,"children":[{"id":"Altruism","name":"Altruism","category":"personality","percentage":0.11994400316283631,"sampling_error":0.069263662},{"id":"Cooperation","name":"Cooperation","category":"personality","percentage":0.49557391964415126,"sampling_error":0.079127247},{"id":"Modesty","name":"Modesty","category":"personality","percentage":0.020131417185579203,"sampling_error":0.054661232000000004},{"id":"Morality","name":"Uncompromising","category":"personality","percentage":0.029038475213683752,"sampling_error":0.0618407095},{"id":"Sympathy","name":"Sympathy","category":"personality","percentage":1,"sampling_error":0.0957370665},{"id":"Trust","name":"Trust","category":"personality","percentage":0.04137286316342057,"sampling_error":0.054678488}]},{"id":"Neuroticism","name":"Emotional range","category":"personality","percentage":0.3185278432018458,"sampling_error":0.0893324705,"children":[{"id":"Anger","name":"Fiery","category":"personality","percentage":0.4521734630008457,"sampling_error":0.0925464545},{"id":"Anxiety","name":"Prone to worry","category":"personality","percentage":0.05804495983285391,"sampling_error":0.053879053999999996},{"id":"Depression","name":"Melancholy","category":"personality","percentage":0.3791174393055145,"sampling_error":0.057365289},{"id":"Immoderation","name":"Immoderation","category":"personality","percentage":0.024639985407909938,"sampling_error":0.0518361005},{"id":"Self-consciousness","name":"Self-consciousness","category":"personality","percentage":0.1360641808142692,"sampling_error":0.055281492499999994},{"id":"Vulnerability","name":"Susceptible to stress","category":"personality","percentage":0.009537691056634363,"sampling_error":0.0840043505}]}]}]},{"id":"needs","name":"Needs","children":[{"id":"Self-expression_parent","name":"Self-expression","category":"needs","percentage":0.08881718448233797,"children":[{"id":"Challenge","name":"Challenge","category":"needs","percentage":0.6132731548697341,"sampling_error":0.0819421135},{"id":"Closeness","name":"Closeness","category":"needs","percentage":0.39292905391765226,"sampling_error":0.08089896649999999},{"id":"Curiosity","name":"Curiosity","category":"needs","percentage":0.21585626190289783,"sampling_error":0.116822896},{"id":"Excitement","name":"Excitement","category":"needs","percentage":0.2113858979280991,"sampling_error":0.1063434445},{"id":"Harmony","name":"Harmony","category":"needs","percentage":0.6285775359024767,"sampling_error":0.1061489845},{"id":"Ideal","name":"Ideal","category":"needs","percentage":0.10605212233355837,"sampling_error":0.09607855900000001},{"id":"Liberty","name":"Liberty","category":"needs","percentage":0.30821782112434615,"sampling_error":0.14207865449999998},{"id":"Love","name":"Love","category":"needs","percentage":0.7789359276786979,"sampling_error":0.097738825},{"id":"Practicality","name":"Practicality","category":"needs","percentage":0.6141408686209764,"sampling_error":0.08477308900000001},{"id":"Self-expression","name":"Self-expression","category":"needs","percentage":0.08881718448233797,"sampling_error":0.0791544435},{"id":"Stability","name":"Stability","category":"needs","percentage":0.34989216066548884,"sampling_error":0.10341444500000001},{"id":"Structure","name":"Structure","category":"needs","percentage":0.4717251177689859,"sampling_error":0.07765546350000001}]}]},{"id":"values","name":"Values","children":[{"id":"Openness to change_parent","name":"Openness to change","category":"values","percentage":1,"children":[{"id":"Conservation","name":"Conservation","category":"values","percentage":0.009611230104538565,"sampling_error":0.0664993965},{"id":"Openness to change","name":"Openness to change","category":"values","percentage":1,"sampling_error":0.063388214},{"id":"Hedonism","name":"Hedonism","category":"values","percentage":0.3394029545437032,"sampling_error":0.1343516495},{"id":"Self-enhancement","name":"Self-enhancement","category":"values","percentage":0.09879456957837825,"sampling_error":0.100708304},{"id":"Self-transcendence","name":"Self-transcendence","category":"values","percentage":0.9838471833801207,"sampling_error":0.07851906750000001}]}]}]}}','{"id":"*UNKNOWN*","source":"*UNKNOWN*","word_count":442,"word_count_message":"There were 442 words in the input. We need a minimum of 3,500, preferably 6,000 or more, to compute statistically significant estimates","processed_lang":"en","tree":{"id":"r","name":"root","children":[{"id":"personality","name":"Big 5 ","children":[{"id":"Conscientiousness_parent","name":"Conscientiousness","category":"personality","percentage":0.9800107704625161,"children":[{"id":"Openness","name":"Openness","category":"personality","percentage":0.9799847135693914,"sampling_error":0.0620359326,"children":[{"id":"Adventurousness","name":"Adventurousness","category":"personality","percentage":0.9817558868932182,"sampling_error":0.0522700626},{"id":"Artistic interests","name":"Artistic interests","category":"personality","percentage":0.8950506103740861,"sampling_error":0.1069206414},{"id":"Emotionality","name":"Emotionality","category":"personality","percentage":0.19875565439243795,"sampling_error":0.0488898754},{"id":"Imagination","name":"Imagination","category":"personality","percentage":0.839999541288817,"sampling_error":0.06595626460000001},{"id":"Intellect","name":"Intellect","category":"personality","percentage":0.9595909438843033,"sampling_error":0.057664727000000006},{"id":"Liberalism","name":"Authority-challenging","category":"personality","percentage":0.9278740547545227,"sampling_error":0.0856532556}]},{"id":"Conscientiousness","name":"Conscientiousness","category":"personality","percentage":0.9800107704625161,"sampling_error":0.0779427466,"children":[{"id":"Achievement striving","name":"Achievement striving","category":"personality","percentage":0.9614332012346247,"sampling_error":0.1010597438},{"id":"Cautiousness","name":"Cautiousness","category":"personality","percentage":0.9265202908533913,"sampling_error":0.0936408724},{"id":"Dutifulness","name":"Dutifulness","category":"personality","percentage":0.49443472279141376,"sampling_error":0.061883283},{"id":"Orderliness","name":"Orderliness","category":"personality","percentage":0.12259578965935958,"sampling_error":0.0719868216},{"id":"Self-discipline","name":"Self-discipline","category":"personality","percentage":0.933426781480623,"sampling_error":0.0477538132},{"id":"Self-efficacy","name":"Self-efficacy","category":"personality","percentage":1,"sampling_error":0.0944849328}]},{"id":"Extraversion","name":"Extraversion","category":"personality","percentage":0.251023257703729,"sampling_error":0.058144575,"children":[{"id":"Activity level","name":"Activity level","category":"personality","percentage":0.5791998805187129,"sampling_error":0.0796940638},{"id":"Assertiveness","name":"Assertiveness","category":"personality","percentage":0.2946674113955287,"sampling_error":0.0849890552},{"id":"Cheerfulness","name":"Cheerfulness","category":"personality","percentage":0.11548829007288619,"sampling_error":0.1070428656},{"id":"Excitement-seeking","name":"Excitement-seeking","category":"personality","percentage":0.01905706049433068,"sampling_error":0.0823675104},{"id":"Friendliness","name":"Outgoing","category":"personality","percentage":0.37185491643048946,"sampling_error":0.0771499818},{"id":"Gregariousness","name":"Gregariousness","category":"personality","percentage":0.0908249960225735,"sampling_error":0.058811264599999996}]},{"id":"Agreeableness","name":"Agreeableness","category":"personality","percentage":0.3268338511340644,"sampling_error":0.0989324,"children":[{"id":"Altruism","name":"Altruism","category":"personality","percentage":0.8058982150680098,"sampling_error":0.0723827028},{"id":"Cooperation","name":"Cooperation","category":"personality","percentage":0.8463298139033114,"sampling_error":0.081467506},{"id":"Modesty","name":"Modesty","category":"personality","percentage":0.6069536420099816,"sampling_error":0.0575022124},{"id":"Morality","name":"Uncompromising","category":"personality","percentage":0.3339470323338912,"sampling_error":0.0644618174},{"id":"Sympathy","name":"Sympathy","category":"personality","percentage":1,"sampling_error":0.0998005962},{"id":"Trust","name":"Trust","category":"personality","percentage":0.5686410742837638,"sampling_error":0.0573456936}]},{"id":"Neuroticism","name":"Emotional range","category":"personality","percentage":0.04106553386210185,"sampling_error":0.0929934344,"children":[{"id":"Anger","name":"Fiery","category":"personality","percentage":0.06265888628208872,"sampling_error":0.0959992686},{"id":"Anxiety","name":"Prone to worry","category":"personality","percentage":0.0834501714492613,"sampling_error":0.056460353},{"id":"Depression","name":"Melancholy","category":"personality","percentage":0.04533235897934128,"sampling_error":0.060208385600000004},{"id":"Immoderation","name":"Immoderation","category":"personality","percentage":0.009806692108118756,"sampling_error":0.054071909},{"id":"Self-consciousness","name":"Self-consciousness","category":"personality","percentage":0.014961899315550108,"sampling_error":0.058273051},{"id":"Vulnerability","name":"Susceptible to stress","category":"personality","percentage":0.0399543977989937,"sampling_error":0.087289716}]}]}]},{"id":"needs","name":"Needs","children":[{"id":"Curiosity_parent","name":"Curiosity","category":"needs","percentage":0.05254722334118357,"children":[{"id":"Challenge","name":"Challenge","category":"needs","percentage":0.3442009512666351,"sampling_error":0.08504359},{"id":"Closeness","name":"Closeness","category":"needs","percentage":0.06264876322839993,"sampling_error":0.0838581276},{"id":"Curiosity","name":"Curiosity","category":"needs","percentage":0.05254722334118357,"sampling_error":0.12153299299999999},{"id":"Excitement","name":"Excitement","category":"needs","percentage":0.08000597119042306,"sampling_error":0.1107794554},{"id":"Harmony","name":"Harmony","category":"needs","percentage":0.2344714658472641,"sampling_error":0.1105846278},{"id":"Ideal","name":"Ideal","category":"needs","percentage":0.06307037252346435,"sampling_error":0.1003220142},{"id":"Liberty","name":"Liberty","category":"needs","percentage":0.06777339847879825,"sampling_error":0.1472173612},{"id":"Love","name":"Love","category":"needs","percentage":0.2196984983769658,"sampling_error":0.1017760744},{"id":"Practicality","name":"Practicality","category":"needs","percentage":0.17906272550977292,"sampling_error":0.088333563},{"id":"Self-expression","name":"Self-expression","category":"needs","percentage":0.6753383825016548,"sampling_error":0.0823926982},{"id":"Stability","name":"Stability","category":"needs","percentage":0.11716148726505657,"sampling_error":0.1076631698},{"id":"Structure","name":"Structure","category":"needs","percentage":0.11952725963995525,"sampling_error":0.0808113356}]}]},{"id":"values","name":"Values","children":[{"id":"Conservation_parent","name":"Conservation","category":"values","percentage":0.009783608908754116,"children":[{"id":"Conservation","name":"Conservation","category":"values","percentage":0.009783608908754116,"sampling_error":0.0689191652},{"id":"Openness to change","name":"Openness to change","category":"values","percentage":0.9785240241451895,"sampling_error":0.06530744799999999},{"id":"Hedonism","name":"Hedonism","category":"values","percentage":0.07507809599045569,"sampling_error":0.13916443820000002},{"id":"Self-enhancement","name":"Self-enhancement","category":"values","percentage":0.40946554150854686,"sampling_error":0.10483770320000001},{"id":"Self-transcendence","name":"Self-transcendence","category":"values","percentage":0.9816391362677517,"sampling_error":0.082556416}]}]}]}}','{"id":"*UNKNOWN*","source":"*UNKNOWN*","word_count":1468,"word_count_message":"There were 1,468 words in the input. We need a minimum of 3,500, preferably 6,000 or more, to compute statistically significant estimates","processed_lang":"en","tree":{"id":"r","name":"root","children":[{"id":"personality","name":"Big 5 ","children":[{"id":"Agreeableness_parent","name":"Agreeableness","category":"personality","percentage":0.9488180666836328,"children":[{"id":"Openness","name":"Openness","category":"personality","percentage":0.6629575821608462,"sampling_error":0.057373356,"children":[{"id":"Adventurousness","name":"Adventurousness","category":"personality","percentage":0.6475650090392416,"sampling_error":0.0491542084},{"id":"Artistic interests","name":"Artistic interests","category":"personality","percentage":0.5348878382172603,"sampling_error":0.1004479012},{"id":"Emotionality","name":"Emotionality","category":"personality","percentage":0.45009747943599493,"sampling_error":0.04626201},{"id":"Imagination","name":"Imagination","category":"personality","percentage":0.44373942230046415,"sampling_error":0.061143400800000004},{"id":"Intellect","name":"Intellect","category":"personality","percentage":0.7659065954198064,"sampling_error":0.0536178764},{"id":"Liberalism","name":"Authority-challenging","category":"personality","percentage":0.27950106614249215,"sampling_error":0.0805019756}]},{"id":"Conscientiousness","name":"Conscientiousness","category":"personality","percentage":0.5175831613004132,"sampling_error":0.0735549432,"children":[{"id":"Achievement striving","name":"Achievement striving","category":"personality","percentage":0.32945570552541403,"sampling_error":0.095412178},{"id":"Cautiousness","name":"Cautiousness","category":"personality","percentage":0.5720987803380985,"sampling_error":0.0883468748},{"id":"Dutifulness","name":"Dutifulness","category":"personality","percentage":0.7659055862780957,"sampling_error":0.0586555428},{"id":"Orderliness","name":"Orderliness","category":"personality","percentage":0.41165640414844096,"sampling_error":0.06775406399999999},{"id":"Self-discipline","name":"Self-discipline","category":"personality","percentage":0.29792714365580664,"sampling_error":0.0453955068},{"id":"Self-efficacy","name":"Self-efficacy","category":"personality","percentage":0.8929407164908297,"sampling_error":0.0885953652}]},{"id":"Extraversion","name":"Extraversion","category":"personality","percentage":0.838197576116731,"sampling_error":0.054141076,"children":[{"id":"Activity level","name":"Activity level","category":"personality","percentage":0.6384308342966274,"sampling_error":0.0748412416},{"id":"Assertiveness","name":"Assertiveness","category":"personality","percentage":0.8270240870474828,"sampling_error":0.0799475544},{"id":"Cheerfulness","name":"Cheerfulness","category":"personality","percentage":0.6156846760678037,"sampling_error":0.1006536536},{"id":"Excitement-seeking","name":"Excitement-seeking","category":"personality","percentage":0.14457711656554031,"sampling_error":0.0787482036},{"id":"Friendliness","name":"Outgoing","category":"personality","percentage":0.9731188856688462,"sampling_error":0.07225189800000001},{"id":"Gregariousness","name":"Gregariousness","category":"personality","percentage":0.7423238834388102,"sampling_error":0.0560822588}]},{"id":"Agreeableness","name":"Agreeableness","category":"personality","percentage":0.9488180666836328,"sampling_error":0.09322541919999999,"children":[{"id":"Altruism","name":"Altruism","category":"personality","percentage":0.9593970119039444,"sampling_error":0.067957232},{"id":"Cooperation","name":"Cooperation","category":"personality","percentage":0.5246239464971169,"sampling_error":0.07706979800000001},{"id":"Modesty","name":"Modesty","category":"personality","percentage":0.33897136333096123,"sampling_error":0.0533249852},{"id":"Morality","name":"Uncompromising","category":"personality","percentage":0.7587962730101926,"sampling_error":0.0604746856},{"id":"Sympathy","name":"Sympathy","category":"personality","percentage":0.945307196892093,"sampling_error":0.0930722656},{"id":"Trust","name":"Trust","category":"personality","percentage":0.7629491958501102,"sampling_error":0.053765851600000004}]},{"id":"Neuroticism","name":"Emotional range","category":"personality","percentage":0.39545633611033115,"sampling_error":0.086262156,"children":[{"id":"Anger","name":"Fiery","category":"personality","percentage":0.5089675242094576,"sampling_error":0.090273988},{"id":"Anxiety","name":"Prone to worry","category":"personality","percentage":0.3048500622868637,"sampling_error":0.052852182},{"id":"Depression","name":"Melancholy","category":"personality","percentage":0.1631670141255669,"sampling_error":0.0560131864},{"id":"Immoderation","name":"Immoderation","category":"personality","percentage":0.019048095873068403,"sampling_error":0.05131889},{"id":"Self-consciousness","name":"Self-consciousness","category":"personality","percentage":0.01782312332594612,"sampling_error":0.0541741912},{"id":"Vulnerability","name":"Susceptible to stress","category":"personality","percentage":0.28915770839365323,"sampling_error":0.081618704}]}]}]},{"id":"needs","name":"Needs","children":[{"id":"Love_parent","name":"Love","category":"needs","percentage":0.9149683020860575,"children":[{"id":"Challenge","name":"Challenge","category":"needs","percentage":0.7371778005328886,"sampling_error":0.0806664532},{"id":"Closeness","name":"Closeness","category":"needs","percentage":0.6622080698953189,"sampling_error":0.0797419092},{"id":"Curiosity","name":"Curiosity","category":"needs","percentage":0.38353384743058216,"sampling_error":0.114467358},{"id":"Excitement","name":"Excitement","category":"needs","percentage":0.416695323971742,"sampling_error":0.10413110839999999},{"id":"Harmony","name":"Harmony","category":"needs","percentage":0.8531301957916936,"sampling_error":0.10398872199999999},{"id":"Ideal","name":"Ideal","category":"needs","percentage":0.21435525960703,"sampling_error":0.0938227904},{"id":"Liberty","name":"Liberty","category":"needs","percentage":0.5849321960231042,"sampling_error":0.1393654712},{"id":"Love","name":"Love","category":"needs","percentage":0.9149683020860575,"sampling_error":0.09574806599999999},{"id":"Practicality","name":"Practicality","category":"needs","percentage":0.8702663826629657,"sampling_error":0.0830935728},{"id":"Self-expression","name":"Self-expression","category":"needs","percentage":0.1669277306203608,"sampling_error":0.0778477128},{"id":"Stability","name":"Stability","category":"needs","percentage":0.6658077984052703,"sampling_error":0.10143160279999999},{"id":"Structure","name":"Structure","category":"needs","percentage":0.4776904103249541,"sampling_error":0.0762240428}]}]},{"id":"values","name":"Values","children":[{"id":"Openness to change_parent","name":"Openness to change","category":"values","percentage":1,"children":[{"id":"Conservation","name":"Conservation","category":"values","percentage":0.009367574034081711,"sampling_error":0.0657029584},{"id":"Openness to change","name":"Openness to change","category":"values","percentage":1,"sampling_error":0.0621425644},{"id":"Hedonism","name":"Hedonism","category":"values","percentage":0.13117316384534236,"sampling_error":0.1308542072},{"id":"Self-enhancement","name":"Self-enhancement","category":"values","percentage":0.03806603269426677,"sampling_error":0.0979668888},{"id":"Self-transcendence","name":"Self-transcendence","category":"values","percentage":1,"sampling_error":0.0764424616}]}]}]}}','{"id":"*UNKNOWN*","source":"*UNKNOWN*","word_count":602,"word_count_message":"There were 602 words in the input. We need a minimum of 3,500, preferably 6,000 or more, to compute statistically significant estimates","processed_lang":"en","tree":{"id":"r","name":"root","children":[{"id":"personality","name":"Big 5 ","children":[{"id":"Extraversion_parent","name":"Extraversion","category":"personality","percentage":1,"children":[{"id":"Openness","name":"Openness","category":"personality","percentage":0.28582046411797357,"sampling_error":0.0609004032,"children":[{"id":"Adventurousness","name":"Adventurousness","category":"personality","percentage":0.5891280054209908,"sampling_error":0.0514582236},{"id":"Artistic interests","name":"Artistic interests","category":"personality","percentage":0.8682232433830267,"sampling_error":0.1052029},{"id":"Emotionality","name":"Emotionality","category":"personality","percentage":0.6604250164102817,"sampling_error":0.048130293},{"id":"Imagination","name":"Imagination","category":"personality","percentage":0.02594758504040891,"sampling_error":0.0647890316},{"id":"Intellect","name":"Intellect","category":"personality","percentage":0.5395509467171081,"sampling_error":0.0566797868},{"id":"Liberalism","name":"Authority-challenging","category":"personality","percentage":0.014768187036666703,"sampling_error":0.084547794}]},{"id":"Conscientiousness","name":"Conscientiousness","category":"personality","percentage":0.44754241485396284,"sampling_error":0.0766806328,"children":[{"id":"Achievement striving","name":"Achievement striving","category":"personality","percentage":0.1287757899859322,"sampling_error":0.09936578480000001},{"id":"Cautiousness","name":"Cautiousness","category":"personality","percentage":0.3937679447908195,"sampling_error":0.0924880858},{"id":"Dutifulness","name":"Dutifulness","category":"personality","percentage":0.37409903760318186,"sampling_error":0.0605517322},{"id":"Orderliness","name":"Orderliness","category":"personality","percentage":0.35477857166513316,"sampling_error":0.07108751940000001},{"id":"Self-discipline","name":"Self-discipline","category":"personality","percentage":0.44702547391755043,"sampling_error":0.047090413},{"id":"Self-efficacy","name":"Self-efficacy","category":"personality","percentage":0.9142489733192878,"sampling_error":0.0930548974}]},{"id":"Extraversion","name":"Extraversion","category":"personality","percentage":1,"sampling_error":0.0573740682,"children":[{"id":"Activity level","name":"Activity level","category":"personality","percentage":0.07722153388166748,"sampling_error":0.078715013},{"id":"Assertiveness","name":"Assertiveness","category":"personality","percentage":1,"sampling_error":0.0839281268},{"id":"Cheerfulness","name":"Cheerfulness","category":"personality","percentage":0.9616133631760659,"sampling_error":0.1056991348},{"id":"Excitement-seeking","name":"Excitement-seeking","category":"personality","percentage":0.23904313751791884,"sampling_error":0.08142421999999999},{"id":"Friendliness","name":"Outgoing","category":"personality","percentage":1,"sampling_error":0.0760541218},{"id":"Gregariousness","name":"Gregariousness","category":"personality","percentage":1,"sampling_error":0.05774519}]},{"id":"Agreeableness","name":"Agreeableness","category":"personality","percentage":1,"sampling_error":0.0974401248,"children":[{"id":"Altruism","name":"Altruism","category":"personality","percentage":0.9822367277600854,"sampling_error":0.0712677736},{"id":"Cooperation","name":"Cooperation","category":"personality","percentage":0.5451843906491729,"sampling_error":0.0806066404},{"id":"Modesty","name":"Modesty","category":"personality","percentage":0.3646347843127899,"sampling_error":0.056389857},{"id":"Morality","name":"Uncompromising","category":"personality","percentage":0.9279708510997281,"sampling_error":0.0634544942},{"id":"Sympathy","name":"Sympathy","category":"personality","percentage":1,"sampling_error":0.0982917242},{"id":"Trust","name":"Trust","category":"personality","percentage":0.7882626603954984,"sampling_error":0.0562234492}]},{"id":"Neuroticism","name":"Emotional range","category":"personality","percentage":0.2844118977234497,"sampling_error":0.0919662034,"children":[{"id":"Anger","name":"Fiery","category":"personality","percentage":0.4672247779355961,"sampling_error":0.0948044156},{"id":"Anxiety","name":"Prone to worry","category":"personality","percentage":0.40432126477510555,"sampling_error":0.0555167692},{"id":"Depression","name":"Melancholy","category":"personality","percentage":0.29285695689814667,"sampling_error":0.0592606422},{"id":"Immoderation","name":"Immoderation","category":"personality","percentage":0.024823902554323526,"sampling_error":0.0528755456},{"id":"Self-consciousness","name":"Self-consciousness","category":"personality","percentage":0.007571827422805666,"sampling_error":0.057164830800000004},{"id":"Vulnerability","name":"Susceptible to stress","category":"personality","percentage":0.4179438172403028,"sampling_error":0.08607107659999999}]}]}]},{"id":"needs","name":"Needs","children":[{"id":"Love_parent","name":"Love","category":"needs","percentage":0.9766290156510783,"children":[{"id":"Challenge","name":"Challenge","category":"needs","percentage":0.20012774317877338,"sampling_error":0.08394475500000001},{"id":"Closeness","name":"Closeness","category":"needs","percentage":0.8648952126444255,"sampling_error":0.0828806372},{"id":"Curiosity","name":"Curiosity","category":"needs","percentage":0.04496399337227602,"sampling_error":0.11986782160000001},{"id":"Excitement","name":"Excitement","category":"needs","percentage":0.4169376115386885,"sampling_error":0.109291366},{"id":"Harmony","name":"Harmony","category":"needs","percentage":0.9425880824895962,"sampling_error":0.10926672},{"id":"Ideal","name":"Ideal","category":"needs","percentage":0.03647744515631432,"sampling_error":0.0989278586},{"id":"Liberty","name":"Liberty","category":"needs","percentage":0.6576620989706244,"sampling_error":0.14522419939999998},{"id":"Love","name":"Love","category":"needs","percentage":0.9766290156510783,"sampling_error":0.10042841479999999},{"id":"Practicality","name":"Practicality","category":"needs","percentage":0.9429050215814683,"sampling_error":0.0868727348},{"id":"Self-expression","name":"Self-expression","category":"needs","percentage":0.0735628346041406,"sampling_error":0.081267083},{"id":"Stability","name":"Stability","category":"needs","percentage":0.42183701302417853,"sampling_error":0.1060905032},{"id":"Structure","name":"Structure","category":"needs","percentage":0.03901456053094135,"sampling_error":0.07956626979999999}]}]},{"id":"values","name":"Values","children":[{"id":"Self-transcendence_parent","name":"Self-transcendence","category":"values","percentage":1,"children":[{"id":"Conservation","name":"Conservation","category":"values","percentage":0.11678241876456621,"sampling_error":0.0685332256},{"id":"Openness to change","name":"Openness to change","category":"values","percentage":0.3370024692020525,"sampling_error":0.0640567662},{"id":"Hedonism","name":"Hedonism","category":"values","percentage":0.009673218824026034,"sampling_error":0.13755692719999998},{"id":"Self-enhancement","name":"Self-enhancement","category":"values","percentage":0.00998739909255172,"sampling_error":0.10317367420000001},{"id":"Self-transcendence","name":"Self-transcendence","category":"values","percentage":1,"sampling_error":0.08138079679999999}]}]}]}}'];
      var user_profile_json = profile;

      var response = [];
      for(var x = 0; x < mock_profiles.length; x++) {
        response[x] = {};
        response[x] = compare_profile(JSON.parse(mock_profiles[x]), user_profile_json);
      }

      return res.json(response);
  });
});

function compare_profile(m1, m2) {
  var response = {};
  var overall_match_diff_avg = 0;
  var needs_match_diff_avg = 0;
  var values_match_diff_avg = 0;

  var m1_vals = [];
  var m2_vals = [];
  var match_vals = [];

  // overall
  console.log("--overall--")
  for(var i=0; i<m1['tree']['children'][0]['children'].length; i++) {
    for(var j=0; j<m1['tree']['children'][0]['children'][i]['children'].length; j++) {
      //console.log(b['p1']['tree']['children'][0]['children'][i]['children'][j]['name']+ ',' +b['p1']['tree']['children'][0]['children'][i]['children'][j]['percentage']);
      m1_vals.push(parseInt(m1['tree']['children'][0]['children'][i]['children'][j]['percentage']*100));
      m2_vals.push(parseInt(m2['tree']['children'][0]['children'][i]['children'][j]['percentage']*100));
      match_vals.push((m1_vals[m1_vals.length-1] - m2_vals[m1_vals.length-1]) < 0 ? (m1_vals[m1_vals.length-1] - m2_vals[m1_vals.length-1])*-1 : (m1_vals[m1_vals.length-1] - m2_vals[m1_vals.length-1]));
      
      console.log(m1_vals[m1_vals.length-1] +","+ m2_vals[m2_vals.length-1]);
    }
  }

  for (var i=0; i<match_vals.length; i++) {
    overall_match_diff_avg += match_vals[i];
  }
  overall_match_diff_avg = 100-parseInt(overall_match_diff_avg/match_vals.length);
  response['overall'] = overall_match_diff_avg;

  // needs
  console.log("--needs--")
  var m1_vals = [];
  var m2_vals = [];
  var match_vals = [];

  for(var i=0; i<m1['tree']['children'][1]['children'].length; i++) {
    for(var j=0; j<m1['tree']['children'][1]['children'][i]['children'].length; j++) {
      //console.log(b['p1']['tree']['children'][0]['children'][i]['children'][j]['name']+ ',' +b['p1']['tree']['children'][0]['children'][i]['children'][j]['percentage']);
      m1_vals.push(parseInt(m1['tree']['children'][1]['children'][i]['children'][j]['percentage']*100));
      m2_vals.push(parseInt(m2['tree']['children'][1]['children'][i]['children'][j]['percentage']*100));
      match_vals.push((m1_vals[m1_vals.length-1] - m2_vals[m1_vals.length-1]) < 0 ? (m1_vals[m1_vals.length-1] - m2_vals[m1_vals.length-1])*-1 : (m1_vals[m1_vals.length-1] - m2_vals[m1_vals.length-1]));

      console.log(m1_vals[m1_vals.length-1] +","+ m2_vals[m2_vals.length-1]);
    }
  }
  for (var i=0; i<match_vals.length; i++) {
    console.log(match_vals[i]);
    needs_match_diff_avg += match_vals[i];
  }
  needs_match_diff_avg = 100-parseInt(needs_match_diff_avg/match_vals.length);
  response['needs'] = needs_match_diff_avg;

  // values
  console.log("--values--")
  var m1_vals = [];
  var m2_vals = [];
  var match_vals = [];

  for(var i=0; i<m1['tree']['children'][2]['children'].length; i++) {
    for(var j=0; j<m1['tree']['children'][2]['children'][i]['children'].length; j++) {
      //console.log(b['p1']['tree']['children'][0]['children'][i]['children'][j]['name']+ ',' +b['p1']['tree']['children'][0]['children'][i]['children'][j]['percentage']);
      m1_vals.push(parseInt(m1['tree']['children'][2]['children'][i]['children'][j]['percentage']*100));
      m2_vals.push(parseInt(m2['tree']['children'][2]['children'][i]['children'][j]['percentage']*100));
      match_vals.push((m1_vals[m1_vals.length-1] - m2_vals[m1_vals.length-1]) < 0 ? (m1_vals[m1_vals.length-1] - m2_vals[m1_vals.length-1])*-1 : (m1_vals[m1_vals.length-1] - m2_vals[m1_vals.length-1]));
      
      console.log(m1_vals[m1_vals.length-1] +","+ m2_vals[m2_vals.length-1]);
    }
  }
  for (var i=0; i<match_vals.length; i++) {
    values_match_diff_avg += match_vals[i];
  }
  values_match_diff_avg = 100-parseInt(values_match_diff_avg/match_vals.length);
  response['values'] = values_match_diff_avg;

  return response;
}

var port = process.env.VCAP_APP_PORT || 3000;
app.listen(port);
console.log('listening at:', port);
